<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../simpla-styles/colors.html" async> <link rel="import" href="../simpla-styles/ui.html" async> <dom-module id="simpla-link"> <template> <style>*,::after,::before,:host{box-sizing:border-box}:host{display:inline-block;overflow:visible;outline:0;font-size:var(--simpla-scale-0);font-family:var(--simpla-font-family);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased}.wrapper{position:relative}.input{position:absolute;top:-.5em;left:50%;transform:translate(-50%,-100%);width:100%;min-width:11em;max-width:16em;padding:.75em 1em;color:#fff;background:var(--simpla-grey-700);border:0;outline:0;border-radius:var(--simpla-border-radius)}.input::-webkit-input-placeholder{color:var(--simpla-med-white)}.input:-ms-input-placeholder{color:var(--simpla-med-white)}.input::placeholder{color:var(--simpla-med-white)}.link{color:inherit;outline:inherit;text-decoration:inherit}.link[data-editable]{cursor:inherit}</style> <div class="wrapper"> <input type="text" class="input" value="{{href::input}}" placeholder="[[placeholder]]" on-keydown="_closeOnHotkeys" hidden$="[[!active]]"> <a href="[[href]]" class="link" data-editable$="[[editable]]" on-tap="_disableLinkWhileEditable"> <slot></slot> </a> </div> </template> <script>!function(){"use strict";var e={properties:{path:{type:String,observer:"_initPath"},_simplaObservers:{type:Object,value:function(){return{}}}},observers:["_updateBuffer(href, path)"],created:function(){window.Simpla||console.error("Cannot find Simpla global")},attached:function(){this.editable=this.editable||Simpla.getState("editable"),this._observeEditable()},detached:function(){var e=this;Object.keys(this._simplaObservers).forEach(function(t){e._simplaObservers[t].unobserve()}),this._simplaObservers=[]},_initPath:function(e){var t=this;Simpla.get(e).then(function(e){return t._setPropsFromSimpla(e)}),this._observeBuffer(e)},_updateBuffer:function(e,t){if(!this.__comingFromSimpla&&e)return Simpla.set(t,{type:"Link",data:{href:this.href}})},_observeBuffer:function(e){var t=this,i=this._simplaObservers;e&&(i.buffer&&i.buffer.unobserve(),i.buffer=Simpla.observe(e,function(e){return t._setPropsFromSimpla(e)}))},_setPropsFromSimpla:function(e){e&&e.data&&(this.__comingFromSimpla=!0,Object.assign(this,e.data),this.__comingFromSimpla=!1)},_observeEditable:function(){var e=this,t=this._simplaObservers;t.editable&&t.editable.unobserve(),t.editable=Simpla.observeState("editable",function(t){return e.editable=t})}};Polymer({is:"simpla-link",properties:{href:{type:String,value:"",notify:!0},placeholder:{type:String,value:"Enter a URL..."},editable:{type:Boolean,value:!1,notify:!0},active:{type:Boolean,value:!1,notify:!0},tabindex:{type:Number,reflectToAttribute:!0,value:0}},listeners:{focus:"_open",tap:"_open",blur:"_close"},behaviors:[e],_open:function(){this.editable&&(this.active=!0)},_close:function(){this.active=!1},_closeOnHotkeys:function(e){var t=13===e.keyCode,i=27===e.keyCode;this.active&&(t||i)&&(this.active=!1)},_disableLinkWhileEditable:function(e){this.editable&&(e.preventDefault(),e.stopPropagation())}})}()</script> </dom-module> 